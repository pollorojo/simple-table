!function(window,angular,undefined){"use strict";function renderPagination(cantidadPaginas,selected){for(var paginator=angular.element('<nav aria-label="Page navigation"><ul class="pagination"></ul></nav>'),i=1;i<=cantidadPaginas;i++)paginator.children("ul").append('<li ng-class="{ active: ('+i+"==="+selected+') }"><a href="#" ng-click="paginate('+i+')">'+i+"</a></li>");return paginator}var app=angular.module("ngSimpleTable",[]);app.provider("ngSimpleTable",[function(){this.$get=["Simplero",function(Simplero){return Simplero}]}]),app.service("Simplero",["orderByFilter",function(orderBy){function actualizar(paramCollection){var paginas=self.obtenerCantidadPaginas(paramCollection),paginaCorrecta=self.obtenerPaginaActual()>paginas?1:self.obtenerPaginaActual(),collection=self.irPagina(paginaCorrecta);!1===angular.isUndefined(listener)&&(listener.$broadcast("paginado",paginas,paginaCorrecta),listener.$broadcast("filtrado",collection))}var listener,self=this,originalCollection=[],temporalCollection=[],config={paginaInicio:1,itemsPorPagina:10,defaultClasses:!0},classes={table:"ng-simple-table","table.thead":"ng-simple-head","table.thead.tr":"ng-simple-row","table.thead.tr.th":"ng-simple-column","table.tbody":"ng-simple-body","table.tbody.tr":"ng-simple-row","table.tbody.tr.td":"ng-simple-cell"},paginaActual=null;return this.filtro=function(filter){actualizar(temporalCollection=filter(originalCollection))},this.getServiceName=function(){return"Simplero"},this.obtenerCantidadPaginas=function(customCollection){var collection;return collection=angular.isUndefined(customCollection)?originalCollection:customCollection,Math.ceil(collection.length/config.itemsPorPagina)},this.obtenerListaOrdenada=function(key,reverse){return temporalCollection=orderBy(temporalCollection,key,reverse),this.irPagina(this.obtenerPaginaActual())},this.obtenerPaginaActual=function(){paginaActual=null===paginaActual?config.paginaInicio:paginaActual;var paginasTotales=this.obtenerCantidadPaginas();return paginaActual>paginasTotales?1:paginaActual},this.obtenerPaginaInicio=function(){var desde=(this.obtenerPaginaActual()-1)*config.itemsPorPagina,hasta=desde+config.itemsPorPagina;return temporalCollection.slice(desde,hasta)},this.irPagina=function(page){paginaActual=page;var desde=1===page?0:(page-1)*config.itemsPorPagina,hasta=desde+config.itemsPorPagina;return temporalCollection.slice(desde,hasta)},this.registrarEscucha=function(scope){listener=scope},this.resetear=function(){temporalCollection=originalCollection;var paginas=this.obtenerCantidadPaginas(temporalCollection);paginaActual=1;var collection=this.irPagina(paginaActual);listener.$broadcast("paginado",paginas,paginaActual),listener.$broadcast("filtrado",collection)},this.isValidCollection=function(collection){return angular.isArray(collection)},this.setCollection=function(collection){var result=!1;return this.isValidCollection(collection)&&(actualizar(temporalCollection=originalCollection=collection),result=!0),result},this.getClassNameTableElement=function(elementName){var value=null;return classes.hasOwnProperty(elementName)&&(value=classes[elementName]),value},this.useDefaultClasses=function(){return config.defaultClasses},function(params){return self.setCollection(params.collection),params.hasOwnProperty("config")&&(params.config.hasOwnProperty("defaultClasses")&&"boolean"!=typeof params.config.defaultClasses&&(params.config.defaultClasses=config.defaultClasses),config=angular.extend(config,params.config)),params.hasOwnProperty("classes")&&(classes=angular.extend(classes,params.classes)),self}}]),app.directive("simpleCol",["$compile",function($compile){return{restrict:"E",require:"^^simpleTable",replace:!0,transclude:!0,scope:{title:"@",key:"@",sort:"=?sort",filtro:"&"},compile:function(tElem,attrs){return function(scope,elem,attrs,IndexController){scope.$parent.$parent.ngSimpleProvider.useDefaultClasses()&&(scope.tcolumnClass=scope.$parent.$parent.ngSimpleProvider.getClassNameTableElement("table.thead.tr.th")),scope.sort=!!angular.isUndefined(scope.sort)||scope.sort;var sortReverse=!1;scope.changeOrder=function(key){sortReverse=!0!==sortReverse,IndexController.setOrder(key,sortReverse)},scope.nombreColumna=angular.isUndefined(attrs.title)?attrs.key:attrs.title,IndexController.addBodyColumn(attrs.key)}},template:'<th class="{{tcolumnClass}}"><a href="" ng-if="(sort==true)" ng-click="changeOrder(key)">{{nombreColumna}}</a><span ng-if="(sort==false)">{{nombreColumna}}</span></th>'}}]),app.directive("simpleTable",["$compile",function($compile){return{replace:!0,restrict:"E",transclude:!0,scope:{class:"@",source:"=",ngSimpleProvider:"="},template:'<div><table class="{{tableClass}}"><thead class="{{theadClass}}"><tr ng-transclude class="{{theadRowClass}}"></tr></thead><tbody class="{{tbodyClass}}" simple-body="htmlTbodyColumns"></tbody></table></div>',controller:["$scope","$element",function($scope,$element){function getClassName(name){return $scope.ngSimpleProvider.getClassNameTableElement(name)}$element[0].className="",angular.isDefined($scope.class)&&!1===$scope.ngSimpleProvider.useDefaultClasses()?$scope.class.length>0&&($scope.tableClass=$scope.class):($scope.tableClass=getClassName("table"),$scope.theadClass=getClassName("table.thead"),$scope.theadRowClass=getClassName("table.thead.tr"),$scope.tbodyClass=getClassName("table.tbody"),$scope.trowClass=getClassName("table.tbody.tr"),$scope.tbodyTdClass=getClassName("table.tbody.tr.td")),$scope.ngSimpleProvider.registrarEscucha($scope),$scope.collection=$scope.ngSimpleProvider.obtenerPaginaInicio();var cantidadPaginas=$scope.ngSimpleProvider.obtenerCantidadPaginas(),paginaInicio=$scope.ngSimpleProvider.obtenerPaginaActual();$element.append($compile(renderPagination(cantidadPaginas,paginaInicio))($scope)),$scope.$on("filtrado",function(ev,collection){$scope.collection=collection}),$scope.$on("paginado",function(ev,paginas,selected){$element.children()[1].remove(),$element.append($compile(renderPagination(paginas,selected))($scope))}),$scope.paginate=function(page){$scope.collection=$scope.ngSimpleProvider.irPagina(page);var nav=$element.children()[1];angular.element(nav.querySelector("li.active")).removeClass("active");var li=$element.find("li")[page-1];angular.element(li).addClass("active")},$scope.htmlTbodyColumns="",this.addBodyColumn=function(key){$scope.htmlTbodyColumns+='<td class="{{tbodyTdClass}}">{{item.'+key+"}}</td>"},this.setOrder=function(key,reverse){$scope.collection=$scope.ngSimpleProvider.obtenerListaOrdenada(key,reverse)}}]}}]),app.directive("simpleBody",["$compile",function($compile){return{restrict:"A",require:"^^simpleTable",replace:!1,scope:{},link:function(scope,element){element.html('<tr ng-repeat="item in collection" class="{{trowClass}}">'+scope.$parent.htmlTbodyColumns+"</tr>"),$compile(element.contents())(scope.$parent)}}}])}(window,angular);