!function(window,angular,undefined){"use strict";function renderPagination(cantidadPaginas,selected){for(var paginator=angular.element('<nav aria-label="Page navigation"><ul class="pagination"></ul></nav>'),i=1;i<=cantidadPaginas;i++)paginator.children("ul").append('<li ng-class="{ active: ('+i+"==="+selected+') }"><a href="#" ng-click="paginate('+i+')">'+i+"</a></li>");return paginator}var app=angular.module("ngSimpleTable",[]);app.provider("ngSimpleTable",[function(){this.$get=["Simplero",function(Simplero){return Simplero}]}]),app.service("Simplero",["orderByFilter",function(orderBy){function actualizar(paramCollection){var paginas=self.obtenerCantidadPaginas(paramCollection),paginaCorrecta=self.obtenerPaginaActual()>paginas?1:self.obtenerPaginaActual(),collection=self.irPagina(paginaCorrecta);!1===angular.isUndefined(listener)&&(listener.$broadcast("paginado",paginas,paginaCorrecta),listener.$broadcast("filtrado",collection))}var listener,self=this,originalCollection=[],temporalCollection=[],config={paginaInicio:1,itemsPorPagina:10},paginaActual=null;return this.filtro=function(filter){actualizar(temporalCollection=filter(originalCollection))},this.getServiceName=function(){return"Simplero"},this.obtenerCantidadPaginas=function(customCollection){var collection;return collection=angular.isUndefined(customCollection)?originalCollection:customCollection,Math.ceil(collection.length/config.itemsPorPagina)},this.obtenerListaOrdenada=function(key,reverse){return temporalCollection=orderBy(temporalCollection,key,reverse),this.irPagina(this.obtenerPaginaActual())},this.obtenerPaginaActual=function(){paginaActual=null===paginaActual?config.paginaInicio:paginaActual;var paginasTotales=this.obtenerCantidadPaginas();return paginaActual>paginasTotales?1:paginaActual},this.obtenerPaginaInicio=function(){var desde=(this.obtenerPaginaActual()-1)*config.itemsPorPagina,hasta=desde+config.itemsPorPagina;return temporalCollection.slice(desde,hasta)},this.irPagina=function(page){paginaActual=page;var desde=1===page?0:(page-1)*config.itemsPorPagina,hasta=desde+config.itemsPorPagina;return temporalCollection.slice(desde,hasta)},this.registrarEscucha=function(scope){listener=scope},this.resetear=function(){temporalCollection=originalCollection;var paginas=this.obtenerCantidadPaginas(temporalCollection);paginaActual=1;var collection=this.irPagina(paginaActual);listener.$broadcast("paginado",paginas,paginaActual),listener.$broadcast("filtrado",collection)},this.isValidCollection=function(collection){return angular.isArray(collection)},this.setCollection=function(collection){var result=!1;return this.isValidCollection(collection)&&(actualizar(temporalCollection=originalCollection=collection),result=!0),result},function(params){return self.setCollection(params.collection),params.hasOwnProperty("config")&&(config=angular.extend(config,params.config)),self}}]),app.directive("simpleCol",["$compile",function($compile){return{restrict:"E",require:"^^simpleTable",replace:!0,transclude:!0,scope:{title:"@",key:"@",sort:"=?sort",filtro:"&"},compile:function(tElem,attrs){return function(scope,elem,attrs,IndexController){scope.sort=!!angular.isUndefined(scope.sort)||scope.sort;var sortReverse=!1;scope.changeOrder=function(key){sortReverse=!0!==sortReverse,IndexController.setOrder(key,sortReverse)},scope.nombreColumna=angular.isUndefined(attrs.title)?attrs.key:attrs.title,IndexController.addBodyColumn(attrs.key)}},template:'<th><a href="" ng-if="(sort==true)" ng-click="changeOrder(key)">{{nombreColumna}}</a><span ng-if="(sort==false)">{{nombreColumna}}</span></th>'}}]),app.directive("simpleTable",["$compile",function($compile){return{replace:!0,restrict:"E",transclude:!0,scope:{tableClass:"@",source:"=",ngSimpleProvider:"="},template:'<div><table class="{{tableClass}}"><thead><tr ng-transclude></tr></thead><tbody simple-body="htmlTbodyColumns"></tbody></table></div>',controller:["$scope","$element",function($scope,$element){$scope.ngSimpleProvider.registrarEscucha($scope),$scope.collection=$scope.ngSimpleProvider.obtenerPaginaInicio();var cantidadPaginas=$scope.ngSimpleProvider.obtenerCantidadPaginas(),paginaInicio=$scope.ngSimpleProvider.obtenerPaginaActual();$element.append($compile(renderPagination(cantidadPaginas,paginaInicio))($scope)),$scope.$on("filtrado",function(ev,collection){$scope.collection=collection}),$scope.$on("paginado",function(ev,paginas,selected){$element.children()[1].remove(),$element.append($compile(renderPagination(paginas,selected))($scope))}),$scope.paginate=function(page){$scope.collection=$scope.ngSimpleProvider.irPagina(page);var nav=$element.children()[1];angular.element(nav.querySelector("li.active")).removeClass("active");var li=$element.find("li")[page-1];angular.element(li).addClass("active")},$scope.htmlTbodyColumns="",this.addBodyColumn=function(key){$scope.htmlTbodyColumns+="<td>{{item."+key+"}}</td>"},this.setOrder=function(key,reverse){$scope.collection=$scope.ngSimpleProvider.obtenerListaOrdenada(key,reverse)}}]}}]),app.directive("simpleBody",["$compile",function($compile){return{restrict:"A",require:"^^simpleTable",replace:!1,scope:{},link:function(scope,element){element.html('<tr ng-repeat="item in collection">'+scope.$parent.htmlTbodyColumns+"</tr>"),$compile(element.contents())(scope.$parent)}}}])}(window,angular);